<html>
	<head>
		<script src="https://cdn.firebase.com/js/client/1.0.6/firebase.js"></script>
		<script src="https://cdn.firebase.com/js/simple-login/1.2.5/firebase-simple-login.js"></script>
		<script>
		try{
		    
		    var firebase = new Firebase("https://trump.firebaseio.com/");
            var auth = new FirebaseSimpleLogin(firebase, function (error, user) {
                if (error) {
                    // an error occurred while attempting login
                    alert(error);
                } else if (user) {
                    // user authenticated with Firebase
                    alert('Firebase/Facebook User ID: ' + user.id + ', Provider: ' + user.provider);
                    alert(firebase.child("users"));
                    if(!firebase.child('users')){
                        firebase.child('users') = [{id:user.id,total_score:0}];
                    } 
                    else {
                        // var user_exists = false;
                        // for(var i = 0; i < firebase.child("users").length; i++){
                            // alert(firebase.child("users")[i].id);
                            // alert(user.id);
                            // if(user.id == firebase.child("users")[i].id){
                                // user_exists = true;
                            // } 
                        // };
                        //if (!user_exists) {
                        firebase.child('users').push({id:user.id,total_score:0});
                        //}
                    }
                } else {
                    // user is logged out
                }
            });
            /* LISTEN FOR EVENTS */
            Ti.App.addEventListener('app:fbAuthed', function (e) {
                auth.login('facebook', {
                    access_token: e.access_token
                });
            });
            Ti.App.addEventListener("app:");
            
            /* FIRE EVENTS */
            firebase.on('value', function (gamedata) {
                Ti.App.fireEvent('app:gameListChanged', { games: gamedata.val().games });
            });
            Ti.App.fireEvent('app:proxyViewLoaded');
        }
        catch(e)
        {
            alert(e);
        }
		</script>
	</head>
	<body></body>
</html>